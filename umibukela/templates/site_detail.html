{% extends "layout.html" %}
{% load pipeline %}

{% block title %}{{ site.name }}{% endblock %}
{% block description %}Site details for {{ site.name }}, {{ site.address_2 }}, {{ site.province.name }}{% endblock %}

{% block js %}
  {{ block.super }}
  {% javascript "site" %}
{% endblock %}

{% block page-content %}

<!-- breadcrumbs -->
<div class="container breadcrumb-container">
  <ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="{% url 'sites' %}">Sites</a></li>
    <li class="active">{{ site.name }}</li>
  </ol>
</div>
<!-- /breadcrumbs -->

<div class="section" id="site-detail">

  <!-- section-header -->
  <div class="section-heading">
    <div class="container">
      <div class="row">
        <div class="col-sm-4 col-xs-9">
          <h3><i class="fa fa-map-marker"></i> Site</h3>
          <h1>{{ site.name }}</h1>
          <h2>{{ site.address_1 }}, {{ site.address_2 }}, {{ site.address_3 }}, {{ site.province.name }}</h2>
          <i class="fa-fw fa fa-phone"></i> <a href="tel:{{ site.telephone.split|join:'-' }}">{{ site.telephone }}</a><br>
          {% if latest_result %}
          <a href="{% url 'site-result' site_slug=site.slug result_id=latest_result.id %}" class="btn btn-primary btn-latest-results"><i class="fa fa-bar-chart"></i> View latest results</a>
          {% endif %}
        </div>
        <div class="col-sm-7">
          <div class="map" data-lat="{{ site.coordinates.y }}" data-lng="{{ site.coordinates.x }}"></div>
        </div>
        <div class="col-sm-1 col-xs-3 text-right">
          <a href="" class="social-media"><i class="fa fa-twitter"></i><br>Tweet</a>
          <a href="" class="social-media"><i class="fa fa-facebook"></i><br>Share</a>
        </div>
      </div>
    </div>
  </div>
  <!-- /section-header -->

  <!-- site-stats -->
  <div class="page-section">
    <div class="container">
      <div class="row">
        <div class="col-sm-8">
          <section class="row stat-row">
            <div class="col-sm-3 col-xs-6">
              <div class="stat stat-number">
                <div class="value">{{ site.result_sets|length }}</div>
                <div class="name">Monitoring cycles</div>
              </div>
            </div>
            <div class="col-sm-3 col-xs-6">
              <div class="stat stat-number">
                <div class="value">?</div>
                <div class="name">Participants</div>
              </div>
            </div>
            <div class="col-sm-3 col-xs-6">
              <div class="stat stat-number">
                <div class="value">?</div>
                <div class="name">Female</div>
              </div>
            </div>
            <div class="col-sm-3 col-xs-6">
              <div class="stat stat-number">
                <div class="value">?</div>
                <div class="name">Male</div>
              </div>
            </div>
          </section>
        </div>
        <div class="col-sm-4">
          <dl>
            <dt>Sector</dt>
            <dd>{{ site.sector.name }}</dd>
            <dt>Community partners</dt>
            {% if site.latest_complete_result %}
            <dd><a href="{% url 'partner' partner_slug=site.latest_complete_result.partner.slug %}">{{ site.latest_complete_result.partner.short_name }}</a></dd>
            {% endif %}
          </dl>
        </div>
      </div>
    </div>
  </div>
  <!-- /site-stats -->

  <!-- site-current-programmes -->
  <div class="site-current-programmes page-section">
    <div class="container">
      <div class="panel panel-default">
        <div class="panel-heading">
          Monitoring programmes
        </div>
        <div class="panel-body">
          {% if site.latest_complete_result %}
          <div class="programme">
            <h3 class="programme-name">{{ site.latest_complete_result.cycle.programme.long_name }}</h3>
            <div class="programme-description">
              {{ site.latest_complete_result.cycle.programme.description }}
            </div>
            <div class="programme-frequency"><strong>Frequency:</strong> {{ site.latest_complete_result.cycle.programme.frequency.name }}</div>
            <div class="programme-last-cycle"><strong>Latest cycle:</strong>
              <a href="{% url 'site-result' site_slug=site.slug result_id=site.latest_complete_result.id %}">
                {{ site.latest_complete_result.cycle.start_date|date:'Y-m-d' }}
                  - {{ site.latest_complete_result.cycle.end_date|date:'Y-m-d' }}
              </a>
              <a href="{% url 'site-result' site_slug=site.slug result_id=site.latest_complete_result.id %}" class="btn btn-primary btn-sm">View results</a></div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <!-- /site-current-programmes -->

</div>

{% endblock %}
